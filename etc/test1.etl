require "metacrunch/test_utils"

dependencies do
  gem "nokogiri", "~> 1.6.7.2"
end

register_options do |options|
  options.add :count_until, "-c", "--count NUMBER", "Count until NUMBER", Integer, default: 10
end

puts "Nokogiri Version: #{Nokogiri::VERSION}"
puts "Options: #{options}"

source Metacrunch::TestUtils::DummySource.new(count_until: options[:count_until])

transformation ->(row) do
  puts "transformation 1 called: #{row}"
  row_buffer(:buffer1, row, size: 5)
end

transformation ->(row) do
  puts "transformation 2 called: #{row}"
end
